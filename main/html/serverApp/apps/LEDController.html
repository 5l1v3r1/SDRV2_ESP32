<!--h1>LED Controller</h1-->
<canvas id="app_LEDController_canvas"></canvas>
<script type="text/javascript">
  $('[href="#LEDcontroller"]').on('click', function() {
    //load the whole page here
    //var canvas = document.getElementById('app_LEDController_canvas');
    //var ctx=canvas.getContext('2d');
    //ctx.fillStyle='#FF0000';
    //ctx.fillRect(0,0,80,100);
  });
  function app_LEDController_ketchProc(processing) {
    var isMousePressed = false;
    var isOpen = false;
    var distance = 0;
    var nowRadius = 0;
    var targetRadius = 0;
    var closeRadius = 0;
    var openRadius = 0;
    var startTime = 0;
    processing.setup = function() {
      console.log(processing);
      var width = $('#LEDcontroller').width();
      var height = $('#LEDcontroller').height();
      processing.size(width, height);
      nowRadius = Math.min(width, height) / 2.0;
      closeRadius = nowRadius;
      openRadius = closeRadius * 1.8;
      var now = new Date();
      startTime = now.getTime();
    };
    processing.mousePressed = function() {
      isMousePressed = true;
    };
    processing.mouseReleased = function() {
      isMousePressed = false;
    };
    processing.mouseClicked = function() {
      isOpen = !isOpen;
      targetRadius = closeRadius;
      if (isOpen) targetRadius = openRadius;
      distance = nowRadius - targetRadius;
      var now = new Date();
      startTime = now.getTime();
    };
    processing.draw = function() {
      var centerX = processing.width / 2, centerY = processing.height / 2;
      var maxArmLength = Math.min(centerX, centerY);

      function drawArm(position, lengthScale, weight) {
        processing.strokeWeight(weight);
        processing.line(centerX, centerY,
          centerX + Math.sin(position * 2 * Math.PI) * lengthScale * maxArmLength,
          centerY - Math.cos(position * 2 * Math.PI) * lengthScale * maxArmLength);
      }

      // erase background
      processing.background(224);

      var now = new Date();
      //processing.fill( 0, 121, 184 );
      processing.fill( 0xDD, 0xA0, 0xDD );
      var deltaT = now.getTime() - startTime;
      distance = distance * Math.exp(-0.0005 * deltaT);
      nowRadius = targetRadius + distance * Math.cos(0.01 * deltaT);
      processing.ellipse(centerX, centerY, nowRadius, nowRadius);



      // Moving hours arm by small increments
      var hoursPosition = (now.getHours() % 12 + now.getMinutes() / 60) / 12;
      drawArm(hoursPosition, 0.5, 5);

      // Moving minutes arm by small increments
      var minutesPosition = (now.getMinutes() + now.getSeconds() / 60) / 60;
      drawArm(minutesPosition, 0.80, 3);

      // Moving hour arm by second increments
      var secondsPosition = now.getSeconds() / 60;


      if (isOpen) {
        drawArm(secondsPosition, 0.90, 1);
      }

    };
  }
  $(function() {
    var canvas = document.getElementById("app_LEDController_canvas");
    var processingInstance = new Processing(canvas, app_LEDController_ketchProc);
  })
</script>
